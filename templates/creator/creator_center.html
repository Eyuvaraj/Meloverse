{% extends './base.html' %}

{% block head %}
<title>Meloverse | Creator Center</title>
<link rel="stylesheet" href="{{ url_for('static', filename='styles/headerfooter.css') }}">
{% endblock %}

{% block navbar %}
<header class="py-3 mb-3 border-bottom">
  <nav class="navbar navbar-expand">
    <div class="container">
      <a href="{{ url_for('user.creator_dashboard', user=current_user.username) }}"
        class="navbar-brand link-body-emphasis">
        ðŸŽ§ Meloverse | Creator Center
      </a>
      <ul class="nav">
        <li class="nav-item"><a href="{{ url_for('user.new', user=current_user.username) }}"
            class="nav-link px-2 link-body-emphasis">New</a></li>
        <li class="nav-item"><a href="{{ url_for('user.announcement', user=current_user.username)}}"
            class="nav-link px-2 link-body-emphasis">Announcements</a></li>
        <li class="nav-item"><a href="{{ url_for('user.profile', user=current_user.username)}}"
            class="nav-link px-2 link-body-emphasis">Profile</a></li>
      </ul>

      <div class="dropdown text-end">
        <a href="#" class="d-block link-body-emphasis text-decoration-none dropdown-toggle" data-bs-toggle="dropdown"
          aria-expanded="false">
          <img src="{{ url_for('static', filename='avatar3.jpg') }}" alt="mdo" width="32" height="32"
            class="rounded-circle">
        </a>
        <ul class="dropdown-menu text-small">
          <li><a class="dropdown-item" href="{{ url_for('user.user_dashboard', user=current_user.username)}}">Meloverse
              (app)</a></li>
          <li>
            <hr class="dropdown-divider">
          </li>
          <li><a class="dropdown-item" href="{{ url_for('auth.logout')}}">Sign out</a></li>
        </ul>
      </div>
    </div>
    </div>
  </nav>
</header>
{% endblock %}

{% block header %}
{% endblock %}

{% block body %}
<main class="flex-shrink-0">
  <div class="container">
    <section>
      {% if status==False %}
      <h3>Release an album or single to view this page</h3>
      <a href="{{ url_for('user.new', user=current_user.username) }}">Go to Release song/album page</a>
      {% else %}
      <div class="card border-dark mb-3">
        <div class="card-body">
          <h5 class="card-title">STATS</h5>
          <hr>
          <div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col">
              <div class="card h-100 mb-3">
                <h5 class="card-header">Published</h5>
                <div class="card-body">
                  <ul class="list-group list-group-flush">
                    {% if albums is not none %}
                    <li class="list-group-item">Albums: {{ creator.no_of_albums }}</li>
                    {% else %}
                    <li class="list-group-item">0 Albums</li>
                    {% endif %} {% if singles is not none %}
                    <li class="list-group-item">Singles/Total songs: {{ creator.no_of_singles }}/{{
                      creator.songs_published }}</li>
                    {% else %}
                    <li class="list-group-item">0 Singles</li>
                    {% endif %}
                  </ul>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="card h-100 mb-3">
                <h5 class="card-header">Most Streamed</h5>
                <div class="card-body">
                  <ul class="list-group list-group-flush">
                    {% if albums!=None %}
                    <li class="list-group-item">Album: {{ most_played_album.album_name }} ({{ most_played_album.plays }}
                      plays)</li>
                    {% else %}
                    <li class="list-group-item">No Albums published</li>
                    {% endif %} {% if singles!=None %}
                    <li class="list-group-item">Song: {{ most_played_song.track_name }} ({{ most_played_song.plays}}
                      plays)</li>
                    {% else %}
                    <li class="list-group-item">No Singles published</li>
                    {% endif %}
                  </ul>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="card h-100 mb-3">
                <h5 class="card-header">Most liked</h5>
                <div class="card-body">
                  <ul class="list-group list-group-flush">
                    {% if album!=None %}
                    <li class="list-group-item">Album: {{ most_liked_album.album_name }} ({{ most_liked_album.likes }}
                      likes)</li>
                    {% else %}
                    <li class="list-group-item">Album: 0(0 likes)</li>
                    {% endif %}
                    <li class="list-group-item">Song: {{ most_liked_song.track_name }} ({{ most_liked_song.likes }}
                      likes)
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endif %}
    </section>
    <br>
    {% if songs_published!=0 %}
    <section>
      <div class="card border-dark mb-3">
        <div class="card-body">
          <h5 class="card-title">MY SONGS</h5>
          <hr>
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Name</th>
                <th>Likes</th>
                <th>Dislikes</th>
                <th>Streams</th>
                <th>Single/Album</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for song in singles %}
              <tr>
                <td>{{ song.track_name }}</td>
                <td>{{ song.likes }}</td>
                <td>{{ song.dislikes }}</td>
                <td>{{ song.plays }}</td>
                <td>Single</td>
                <td>
                  <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal"
                    data-bs-target="#editsingle_{{ song.track_id }}">
                    Edit
                  </button>
                  <div class="modal fade" id="editsingle_{{ song.track_id }}" data-bs-backdrop="static"
                    data-bs-keyboard="false" tabindex="-1" aria-labelledby="editsingleLabel" aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="editsingleLabel">Edit Song "{{ song.track_name }}"</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          <form id="edit_single" method="post">
                            <div class="form-group mt-2 mb-2">
                              <label for="song_name">Song Name :</label>
                              <input type="text" id="song_name" placeholder="Song Name" name="song_name" required="True"
                                class="form-control" value="{{ song.track_name }}">
                            </div>
                            <div class="form-group mt-2 mb-2">
                              <label for="artists">Artists :</label>
                              <input type="text" id="artists" placeholder="Artist name" name="artists" required="True"
                                class="form-control" value="{{ song.artists }}">
                            </div>
                            <div class="form-group mt-2 mb-2">
                              <label for="genre">Genre :</label>
                              <input type="text" id="genre" placeholder="Genre" name="genre" required="True"
                                class="form-control" value="{{ song.genre }}">
                            </div>
                            <div class="form-group mt-2 mb-2">
                              <label for="lyrics">Lyrics :</label>
                              <textarea id="lyrics" placeholder=" " name="lyrics" class="form-control"
                                rows="4">{{ song.lyrics }}</textarea>
                            </div>
                            <div class="form-group mt-2 mb-2">
                              <label for="duration">Duration :</label>
                              <input type="text" id="duration" placeholder="Duration" name="duration" required="True"
                                class="form-control" value="{{ song.duration }}">
                            </div>
                            <!-- <div class="form-group mt-2 mb-2">
                            <label for="album">Album :</label>
                            <input type="text" id="album" placeholder="Enter Artist name" name="album" required="True"
                              class="form-control" value="{{ song.album_id }}">
                          </div> -->
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                          <input type="hidden" name="song_id" value="{{ song.track_id }}">
                          <button type="submit" name="edit_song" value="yes" class="btn btn-danger">Edit</button>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>

                  <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal"
                    data-bs-target="#deletesingle_{{ song.track_id }}">
                    Delete
                  </button>
                  <div class="modal fade" id="deletesingle_{{ song.track_id }}" data-bs-backdrop="static"
                    data-bs-keyboard="false" tabindex="-1" aria-labelledby="deletesingleLabel" aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="deletesingleLabel">Delete Song "{{ song.track_name }}"</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          Are you sure you want to delete this song? You cannot undo this action!!
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                          <form method="post">
                            <input type="hidden" name="song_id" value="{{ song.track_id }}">
                            <button type="submit" name="delete_song" value="yes" class="btn btn-danger">Delete</button>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
              {% endfor %}
              {% for song, album in songs %}
              <tr>
                <td>{{ song.track_name }}</td>
                <td>{{ song.likes }}</td>
                <td>{{ song.dislikes }}</td>
                <td>{{ song.plays }}</td>
                <td>{{ album }}</td>
                <td>
                  <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal"
                    data-bs-target="#editsingle_{{ song.track_id }}">
                    Edit
                  </button>
                  <div class="modal fade" id="editsingle_{{ song.track_id }}" data-bs-backdrop="static"
                    data-bs-keyboard="false" tabindex="-1" aria-labelledby="editsingleLabel" aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="editsingleLabel">Edit Song "{{ song.track_name }}"</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          <form id="edit_single" method="post">
                            <div class="form-group mt-2 mb-2">
                              <label for="song_name">Song Name :</label>
                              <input type="text" id="song_name" placeholder="Song Name" name="song_name" required="True"
                                class="form-control" value="{{ song.track_name }}">
                            </div>
                            <div class="form-group mt-2 mb-2">
                              <label for="artists">Artists :</label>
                              <input type="text" id="artists" placeholder="Artist name" name="artists" required="True"
                                class="form-control" value="{{ song.artists }}">
                            </div>
                            <div class="form-group mt-2 mb-2">
                              <label for="genre">Genre :</label>
                              <input type="text" id="genre" placeholder="Genre" name="genre" required="True"
                                class="form-control" value="{{ song.genre }}">
                            </div>
                            <div class="form-group mt-2 mb-2">
                              <label for="lyrics">Lyrics :</label>
                              <textarea id="lyrics" placeholder=" " name="lyrics" class="form-control"
                                rows="4">{{ song.lyrics }}</textarea>
                            </div>
                            <div class="form-group mt-2 mb-2">
                              <label for="duration">Duration :</label>
                              <input type="text" id="duration" placeholder="Duration" name="duration" required="True"
                                class="form-control" value="{{ song.duration }}">
                            </div>
                            <!-- <div class="form-group mt-2 mb-2">
                            <label for="album">Album :</label>
                            <input type="text" id="album" placeholder="Enter Artist name" name="album" required="True"
                              class="form-control" value="{{ song.album_id }}">
                          </div> -->
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                          <input type="hidden" name="song_id" value="{{ song.track_id }}">
                          <button type="submit" name="edit_song" value="yes" class="btn btn-danger">Edit</button>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                  <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal"
                    data-bs-target="#deletesong_{{ song.track_id }}">
                    Delete
                  </button>
                  <div class="modal fade" id="deletesong_{{ song.track_id }}" data-bs-backdrop="static"
                    data-bs-keyboard="false" tabindex="-1" aria-labelledby="deletesongLabel" aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="deletesongLabel">Delete Song "{{ song.track_name }}"</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          Are you sure you want to delete this song? You cannot undo this action!!
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                          <form method="post">
                            <input type="hidden" name="song_id" value="{{ song.track_id }}">
                            <button type="submit" name="delete_song" value="yes" class="btn btn-danger">Delete</button>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </section>
    <br>
    {% endif %}
    {% if albums_published!=0 %}
    <section>
      <div class="card border-dark mb-3">
        <div class="card-body">
          <h5 class="card-title">MY ALBUMS</h5>
          <hr>
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Name</th>
                <th>Likes</th>
                <th>Dislikes</th>
                <th>Streams</th>
                <th>No. of Tracks</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              {% for album, plays, likes, dislikes in album_obj %}
              <tr>
                <td>{{ album.album_name }}</td>
                <td>{{ likes }}</td>
                <td>{{ dislikes }}</td>
                <td>{{ plays }}</td>
                <td>{{ album.no_of_tracks }}</td>
                <td>
                  <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal"
                    data-bs-target="#editalbum_{{ album.album_id }}">
                    Edit
                  </button>
                  <div class="modal fade" id="editalbum_{{ album.album_id }}" data-bs-backdrop="static"
                    data-bs-keyboard="false" tabindex="-1" aria-labelledby="editalbumLabel" aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="editalbumLabel">Edit Album "{{ album.album_name }}"</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          <form id="edit_album" method="post">
                            <div class="form-group mt-2 mb-2">
                              <label for="album_name">Album Name :</label>
                              <input type="text" id="album_name" placeholder="Album Name" name="album_name"
                                required="True" class="form-control" value="{{ album.album_name }}">
                            </div>
                            <div class="form-group mt-2 mb-2">
                              <label for="genre">Genre :</label>
                              <input type="text" id="genre" placeholder="Genre" name="genre" required="True"
                                class="form-control" value="{{ album.genre }}">
                            </div>
                            <div class="form-group mt-2 mb-2">
                              <label for="release_year">Release year :</label>
                              <input type="text" id="release_year" placeholder="Release Year" name="release_year"
                                required="True" class="form-control" value="{{ album.release_year }}">
                            </div>
                            <div class="form-group mt-2 mb-2">
                              <label for="description">Description :</label>
                              <textarea id="description" placeholder=" " name="description" class="form-control"
                                rows="4">{{ album.description }}</textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                          <input type="hidden" name="album_id" value="{{ album.album_id }}">
                          <button type="submit" name="edit_album" value="yes" class="btn btn-danger">Edit</button>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>


                  <button type="button" class="btn btn-outline-danger btn-sm" data-bs-toggle="modal"
                    data-bs-target="#deletealbum_{{ album.album_id }}">
                    Delete
                  </button>
                  <div class="modal fade" id="deletealbum_{{ album.album_id}}" data-bs-backdrop="static"
                    data-bs-keyboard="false" tabindex="-1" aria-labelledby="deletealbumLabel" aria-hidden="true">
                    <div class="modal-dialog">
                      <div class="modal-content">
                        <div class="modal-header">
                          <h5 class="modal-title" id="deletealbumLabel">Delete Album "{{ album.album_name }}"</h5>
                          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                          <p>Are you sure you want to delete this Album and its associated tracks? You cannot undo this
                            action!!</p>

                          <p>Tracks which will be deleted: </p>

                          <ul class="list-group list-group-flush">
                            {% for song, x in songs %}
                            {% if x == album.album_name %}
                            <li class="list-group-item">{{ song.track_name }}</li>
                            {% endif %}
                            {% endfor %}
                          </ul>
                        </div>
                        <div class="modal-footer">
                          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                          <form method="post">
                            <input type="hidden" name="album_id" value="{{ album.album_id }}">
                            <button type="submit" name="delete_album" value="yes" class="btn btn-danger">Delete</button>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </section>
    {% endif %}
  </div>
</main>
{% endblock %}

{% block footer %}
<br>
<footer class="footer mt-auto py-3 bg-body-tertiary">
  <div class="container">
    <span class="text-body-secondary">Place sticky footer content here.</span>
  </div>
</footer>
{% endblock %}